<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸ“° NetWatch | Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Limit approval chart size */
    #approvalChart {
      max-width: 600px;
      max-height: 300px;
      margin: 0 auto;
      display: block;
    }
    .live-panel canvas {
      width: 100% !important;
      height: auto !important;
    }
  </style>
</head>
<body>
  <!-- Banner -->
  <div class="gov-banner">
    <span class="flag">ðŸ‡ºðŸ‡¸</span> Not an official website of the United States government
    <a id="gov-toggle">Here's how you know</a>
    <div class="gov-dropdown" id="gov-info">
      <div><strong>Websites use .gov</strong> <span class="desc">A .gov website belongs to a government organization in the United States.</span></div>
      <div><strong>Secure websites use HTTPS</strong> <span class="desc">A lock (ðŸ”’) or https:// means youâ€™re safely connected. Share sensitive information only on secure sites.</span></div>
    </div>
  </div>

  <!-- Header -->
  <header class="card header">
    <div class="brand"><img src="logo.png" alt="NetWatch logo"/> NetWatch</div>
    <div style="display:flex; align-items:center; gap:16px">
      <div id="clock" class="clock">--:--</div>
      <button class="weather" id="weatherBtn" aria-expanded="false" aria-controls="weatherPanel" title="Local weather">
        <span class="wx-icon" id="wx-icon">â›…</span>
        <span class="wx-temp" id="wx-temp">--Â°</span>
        <span class="wx-place" id="wx-place">Locatingâ€¦</span>
        <span class="wx-caret">â–¾</span>
      </button>
      <div class="weather-panel" id="weatherPanel">
        <div class="weather-head">
          <div class="wx-meta" id="wx-meta">â€”</div>
          <div class="unit-toggle">
            <button id="uF" class="active" type="button">Â°F</button>
            <button id="uC" type="button">Â°C</button>
          </div>
        </div>
        <div class="forecast" id="wx-forecast"></div>
        <div class="daily" id="wx-daily"></div>
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="topnav">
    <a href="#home">Home</a>
    <a href="#news">News & Testimonies</a>
    <a href="#medicaid">Medicaid</a>
    <a href="#social-security">Social Security</a>
  </nav>

  <!-- Main -->
  <main class="container" id="home">
    <h1 class="title">ðŸ“° NetWatch</h1>
    <p class="subtitle">A data-driven project to track threats to health safety nets â€“ because it belongs to everyone.</p>

    <!-- Executive Tracker -->
    <section class="exec" aria-labelledby="exec-title">
      <img id="seal" alt="Seal of the President of the United States" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Seal_of_the_President_of_the_United_States.svg/240px-Seal_of_the_President_of_the_United_States.svg.png"/>
      <div>
        <h2 id="exec-title">Executive Tracker</h2>
        <dl class="grid">
          <dt>President</dt><dd>Donald J. Trump (47th)</dd>
          <dt>Vice President</dt><dd>JD Vance</dd>
          <dt>Term</dt><dd>January 20, 2025 â€“ January 20, 2029</dd>
          <dt>Last Update</dt><dd id="last-update">â€”</dd>
        </dl>
      </div>
    </section>

    <!-- What Weâ€™re Watching -->
    <section class="watching-section">
      <h2>What Weâ€™re Watching</h2>
      <div class="cards">
        <div class="card"><h3>ðŸŸ¡ Social Security</h3><p>Proposals to privatize or implement adjustments</p></div>
        <div class="card"><h3>ðŸ”µ Medicaid</h3><p>Reductions to funding that covers low-income care</p></div>
        <div class="card"><h3>ðŸŸ  Housing</h3><p>Funding for Section 8 housing or other voucher programs</p></div>
        <div class="card"><h3>âš« SNAP / EBT</h3><p>Extending work requirements or cutting eligibility</p></div>
      </div>
    </section>

    <!-- Live Panels -->
    <section class="live-panel">
      <h2>Approval Ratings</h2>
      <canvas id="approvalChart"></canvas>
    </section>

    <section class="live-panel">
      <h2>Livestock Market</h2>
      <div id="market">Loadingâ€¦</div>
    </section>

    <!-- Congress Directory -->
    <section class="congress" id="congress">
      <h2>Members of Congress â€” Live Directory</h2>
      <div class="controls">
        <input id="filterText" type="search" placeholder="Search name, state, party" aria-label="Filter" />
        <select id="filterChamber" aria-label="Chamber">
          <option value="">All Chambers</option>
          <option value="House">House</option>
          <option value="Senate">Senate</option>
        </select>
        <select id="filterState" aria-label="State"></select>
      </div>
      <div id="congressNote" style="color: var(--muted); font-size:13px; margin-bottom:6px"></div>
      <div style="overflow:auto">
        <table id="congressTable" aria-live="polite">
          <thead>
            <tr>
              <th>Name</th>
              <th>Chamber</th>
              <th>State/Dist.</th>
              <th>Party</th>
              <th>Term Ends</th>
              <th>Days Left</th>
              <th>Profile</th>
            </tr>
          </thead>
          <tbody><tr><td colspan="7" style="color:var(--muted)">Loadingâ€¦</td></tr></tbody>
        </table>
      </div>
    </section>

    <!-- Resources -->
    <section class="links">
      <div class="block">
        <h3>Federal Agencies</h3>
        <a href="https://www.cms.gov/" target="_blank">CMS</a>
        <a href="https://www.hud.gov/" target="_blank">HUD</a>
        <a href="https://www.usda.gov/" target="_blank">USDA</a>
        <a href="https://www.ssa.gov/" target="_blank">SSA</a>
      </div>
      <div class="block">
        <h3>Official Registers</h3>
        <a href="https://www.federalregister.gov/" target="_blank">Federal Register</a>
        <a href="https://www.congress.gov/" target="_blank">Congress</a>
        <a href="https://www.govinfo.gov/" target="_blank">GovInfo</a>
      </div>
    </section>
  </main>

  <footer>Â© <span id="year"></span> NetWatch â€¢ Atlanta, GA 30303</footer>

  <!-- Scripts -->
  <script src="app.js"></script>
  <script src="weather.js"></script>
  <script src="market.js"></script>
  <script src="approval.js"></script>

  <script>
    // Congress.gov API integration (requires API key in meta if available)
    async function buildCongress(){
      const key = (document.querySelector('meta[name="congress-api-key"]')||{}).content;
      const note = document.getElementById('congressNote');
      const tbody = document.querySelector('#congressTable tbody');
      const congressNumber = 119;
      if(!tbody) return;
      let members=[];
      if(key){
        try{
          const url = `https://api.congress.gov/v3/member/congress/${congressNumber}?currentMember=true&limit=250&format=json&api_key=${key}`;
          const resp = await fetch(url);
          if(resp.ok){
            const json = await resp.json();
            members = (json.members||[]).map(m=>({
              name: m.fullName,
              chamber: m.chamber,
              state: m.state + (m.district?`-${m.district}`:''),
              party: m.party,
              end: m.endDate,
              url: m.url
            }));
          }
        }catch(e){ console.error(e); }
      }
      if(!members.length){
        note.innerHTML = 'Add your Congress.gov API key in <code>&lt;meta name="congress-api-key"&gt;</code> for live updates. For now, use official directories.';
        tbody.innerHTML = `<tr><td colspan="7"><a href="https://www.senate.gov/senators/" target="_blank">Senators</a> Â· <a href="https://www.house.gov/representatives" target="_blank">Representatives</a></td></tr>`;
        return;
      }
      tbody.innerHTML = members.map(m=>{
        const end = m.end ? new Date(m.end) : null;
        const today = new Date();
        const daysLeft = end ? Math.ceil((end - today)/86400000) : '';
        return `<tr>
          <td>${m.name}</td>
          <td>${m.chamber}</td>
          <td>${m.state}</td>
          <td>${m.party}</td>
          <td>${m.end? new Date(m.end).toLocaleDateString():''}</td>
          <td>${daysLeft}</td>
          <td><a href="${m.url}" target="_blank">Profile â†—</a></td>
        </tr>`;
      }).join('');
    }

    // Filters
    function initFilters(){
      const tbody=document.querySelector('#congressTable tbody');
      const filterText=document.getElementById('filterText');
      const filterChamber=document.getElementById('filterChamber');
      const filterState=document.getElementById('filterState');
      const apply=()=>{
        const q=(filterText.value||'').toLowerCase();
        const ch=filterChamber.value;
        const st=filterState.value;
        for(const tr of tbody.querySelectorAll('tr')){
          const name=tr.children[0].textContent.toLowerCase();
          const chamber=tr.children[1].textContent;
          const state=tr.children[2].textContent;
          const party=tr.children[3].textContent.toLowerCase();
          const matchesText=!q||name.includes(q)||party.includes(q)||state.toLowerCase().includes(q);
          const matchesChamber=!ch||chamber===ch;
          const matchesState=!st||state.startsWith(st);
          tr.style.display=(matchesText&&matchesChamber&&matchesState)?'':'none';
        }
      };
      filterText.addEventListener('input',apply);
      filterChamber.addEventListener('change',apply);
      filterState.addEventListener('change',apply);
    }

    document.addEventListener('DOMContentLoaded',()=>{
      buildCongress();
      initFilters();
      document.getElementById('year').textContent=new Date().getFullYear();
    });
  </script>
</body>
</html>
